version: '3.8'

services:
  discord-relay:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: discord-relay
    restart: unless-stopped
    environment:
      # Only set non-sensitive defaults here
      # All sensitive config (tokens, secrets) should be in config.env file
      - BOT_PREFIX=${BOT_PREFIX:-!bot}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - NODE_ENV=${NODE_ENV:-production}
      - START_WEBUI=${START_WEBUI:-true}
      - WEBUI_PORT=${WEBUI_PORT:-3001}
    ports:
      - "${WEBUI_PORT:-3001}:3001"  # Web UI port for configuration
    volumes:
      # Mount a data directory for persistent configuration
      # The app will auto-create config.env from template if it doesn't exist
      - ./data:/app/data:rw
    # Bot connects outbound to Discord Gateway (no inbound ports needed for bot itself)
    # Optional: join existing network if n8n is on same network
    # networks:
    #   - default
    #   - n8n-network  # Uncomment if n8n is on a named network
