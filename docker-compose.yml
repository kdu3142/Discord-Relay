version: '3.8'

services:
  discord-relay:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: discord-relay
    restart: unless-stopped
    environment:
      # Only set non-sensitive defaults here
      # All sensitive config (tokens, secrets) should be in config.env file
      - BOT_PREFIX=${BOT_PREFIX:-!bot}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - NODE_ENV=${NODE_ENV:-production}
      - START_WEBUI=${START_WEBUI:-true}
      - WEBUI_PORT=${WEBUI_PORT:-3001}
    ports:
      - "${WEBUI_PORT:-3001}:3001"  # Web UI port for configuration
    volumes:
      # Mount config.env if it exists, otherwise it will be created by the app from template
      # Note: If config.env doesn't exist locally, Docker may create a directory - the app handles this
      - ./config.env:/app/config.env:rw  # Main configuration file - edit this or use Web UI
      # Also mount template so app can create config.env from it
      - ./config.env.example:/app/config.env.example:ro  # Template file (read-only)
    # Bot connects outbound to Discord Gateway (no inbound ports needed for bot itself)
    # Optional: join existing network if n8n is on same network
    # networks:
    #   - default
    #   - n8n-network  # Uncomment if n8n is on a named network
